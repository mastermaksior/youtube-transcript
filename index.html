<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>YouTube Transcript Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 700px;
      margin: auto;
    }
    #transcript {
      white-space: pre-wrap;
      margin-top: 20px;
      border: 1px solid #ccc;
      padding: 10px;
    }
  </style>
</head>
<body>
  <h1>YouTube Transcript</h1>
  <input type="text" id="youtubeUrl" placeholder="Paste YouTube link" size="50">
  <select id="lang">
    <option value="en">English</option>
    <option value="pl">Polski</option>
    <option value="es">Espa√±ol</option>
  </select>
  <button onclick="getTranscript()">Get Transcript</button>

  <div id="transcript"></div>

  <script>
    function getVideoId(url) {
      const match = url.match(/(?:youtu\.be\/|youtube\.com\/(?:watch\?v=|embed\/))([a-zA-Z0-9_-]{11})/);
      return match ? match[1] : null;
    }

    async function getTranscript() {
      const url = document.getElementById("youtubeUrl").value.trim();
      const lang = document.getElementById("lang").value;
      const videoId = getVideoId(url);
      const transcriptDiv = document.getElementById("transcript");

      if (!videoId) {
        transcriptDiv.textContent = "Invalid YouTube URL.";
        return;
      }

      const transcriptUrl = `https://video.google.com/timedtext?lang=${lang}&v=${videoId}`;
      
      try {
        const res = await fetch(transcriptUrl);
        if (!res.ok) throw new Error("No captions found.");
        const xml = await res.text();
        const parser = new DOMParser();
        const xmlDoc = parser.parseFromString(xml, "text/xml");

        const texts = Array.from(xmlDoc.getElementsByTagName("text")).map(el =>
          el.textContent.replace(/&#39;/g, "'").replace(/&quot;/g, '"')
        );

        transcriptDiv.textContent = texts.length ? texts.join("\n") : "No transcript found.";
      } catch (e) {
        transcriptDiv.textContent = "Transcript could not be loaded.";
      }
    }
  </script>
</body>
</html>
